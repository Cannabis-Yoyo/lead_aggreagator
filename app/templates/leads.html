{% extends "base.html" %}
{% block title %}Leads - LeadAggregator{% endblock %}
{% block content %}

<div class="mb-6 flex items-center justify-between">
    <div>
        <h1 class="text-2xl font-bold text-white mb-1">All Leads</h1>
        <p style="color:#94a3b8;font-size:14px;">{{ leads | length }} total records</p>
    </div>
    <div class="flex gap-3">
        <select id="filterSource" onchange="filterLeads()" style="background:#1e293b;border:1px solid #334155;color:#f1f5f9;padding:8px 14px;border-radius:8px;font-size:13px;">
            <option value="">All Sources</option>
            <option value="facebook">Facebook</option>
            <option value="google">Google</option>
            <option value="form">Form</option>
            <option value="email">Email</option>
        </select>
        <select id="filterStatus" onchange="filterLeads()" style="background:#1e293b;border:1px solid #334155;color:#f1f5f9;padding:8px 14px;border-radius:8px;font-size:13px;">
            <option value="">All Status</option>
            <option value="new">New</option>
            <option value="contacted">Contacted</option>
            <option value="converted">Converted</option>
            <option value="junk">Junk</option>
        </select>
    </div>
</div>

<div class="card" style="padding:0;overflow:hidden;">
    <table style="width:100%;border-collapse:collapse;font-size:13px;" id="leadsTable">
        <thead>
            <tr style="background:#0f172a;color:#64748b;border-bottom:1px solid #334155;">
                <th style="text-align:left;padding:12px 16px;">Name</th>
                <th style="text-align:left;padding:12px 16px;">Email</th>
                <th style="text-align:left;padding:12px 16px;">Phone</th>
                <th style="text-align:left;padding:12px 16px;">Source</th>
                <th style="text-align:left;padding:12px 16px;">Team</th>
                <th style="text-align:left;padding:12px 16px;">Status</th>
                <th style="text-align:left;padding:12px 16px;">Tags</th>
                <th style="text-align:left;padding:12px 16px;">Date</th>
            </tr>
        </thead>
        <tbody>
            {% for lead in leads %}
            <tr class="lead-row" data-source="{{ lead.source }}" data-status="{{ lead.status }}" style="border-bottom:1px solid #0f172a;cursor:pointer;" onclick="window.location='/lead/{{ lead.id }}'" onmouseover="this.style.background='#0f172a'" onmouseout="this.style.background='transparent'">
                <td style="padding:11px 16px;color:#f1f5f9;font-weight:500;">{{ lead.name or '-' }}</td>
                <td style="padding:11px 16px;color:#94a3b8;">{{ lead.email or '-' }}</td>
                <td style="padding:11px 16px;color:#94a3b8;">{{ lead.phone or '-' }}</td>
                <td style="padding:11px 16px;"><span class="badge badge-{{ lead.source }}">{{ lead.source }}</span></td>
                <td style="padding:11px 16px;color:#94a3b8;">{{ lead.assigned_team or '-' }}</td>
                <td style="padding:11px 16px;"><span class="badge badge-{{ lead.status }}">{{ lead.status }}</span></td>
                <td style="padding:11px 16px;color:#64748b;font-size:11px;">{{ lead.tags or '[]' }}</td>
                <td style="padding:11px 16px;color:#64748b;">{{ lead.created_at.strftime('%b %d, %H:%M') if lead.created_at else '-' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% endblock %}
{% block scripts %}
function filterLeads() {
    const source = document.getElementById('filterSource').value;
    const status = document.getElementById('filterStatus').value;
    document.querySelectorAll('.lead-row').forEach(row => {
        const sourceMatch = !source || row.dataset.source === source;
        const statusMatch = !status || row.dataset.status === status;
        row.style.display = sourceMatch && statusMatch ? '' : 'none';
    });
}
{% endblock %}