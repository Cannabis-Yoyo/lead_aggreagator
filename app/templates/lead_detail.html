{% extends "base.html" %}
{% block title %}Lead #{{ lead.id }} - LeadAggregator{% endblock %}
{% block content %}

<div class="mb-6">
    <a href="/leads-page" style="color:#6366f1;font-size:13px;text-decoration:none;">Back to Leads</a>
</div>

<div class="grid grid-cols-3 gap-5">
    <div class="card col-span-2">
        <h2 class="text-xl font-bold text-white mb-6">{{ lead.name or 'Unknown Lead' }}</h2>
        <div class="grid grid-cols-2 gap-4">
            {% set fields = [('Email', lead.email), ('Phone', lead.phone), ('Source', lead.source), ('Country', lead.country), ('Assigned Team', lead.assigned_team), ('Status', lead.status)] %}
            {% for label, value in fields %}
            <div style="background:#0f172a;border-radius:8px;padding:14px;">
                <p style="color:#64748b;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:4px;">{{ label }}</p>
                <p style="color:#f1f5f9;font-size:14px;font-weight:500;">{{ value or '-' }}</p>
            </div>
            {% endfor %}
        </div>
        {% if lead.message %}
        <div style="background:#0f172a;border-radius:8px;padding:14px;margin-top:16px;">
            <p style="color:#64748b;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:4px;">Message</p>
            <p style="color:#f1f5f9;font-size:14px;">{{ lead.message }}</p>
        </div>
        {% endif %}
        <div style="background:#0f172a;border-radius:8px;padding:14px;margin-top:16px;">
            <p style="color:#64748b;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:8px;">Tags</p>
            <div class="flex gap-2 flex-wrap">
                {% for tag in lead.tags | replace('[','') | replace(']','') | replace('"','') | split(',') %}
                <span style="background:#1e293b;border:1px solid #334155;color:#94a3b8;padding:3px 10px;border-radius:999px;font-size:11px;">{{ tag.strip() }}</span>
                {% endfor %}
            </div>
        </div>
    </div>

    <div class="card" style="height:fit-content;">
        <p style="color:#94a3b8;font-size:13px;font-weight:600;margin-bottom:16px;">Update Status</p>
        <div class="flex flex-col gap-2">
            {% for s in ['new', 'contacted', 'converted', 'junk'] %}
            <button onclick="updateStatus('{{ s }}')" style="background:{% if lead.status == s %}#6366f1{% else %}#0f172a{% endif %};color:{% if lead.status == s %}white{% else %}#94a3b8{% endif %};border:1px solid #334155;padding:10px;border-radius:8px;cursor:pointer;font-size:13px;font-weight:500;text-align:left;">
                {{ s | capitalize }}
            </button>
            {% endfor %}
        </div>
        <div style="margin-top:24px;padding-top:16px;border-top:1px solid #334155;">
            <p style="color:#64748b;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:4px;">Lead ID</p>
            <p style="color:#f1f5f9;font-size:13px;">#{{ lead.id }}</p>
            <p style="color:#64748b;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;margin-top:12px;margin-bottom:4px;">Created</p>
            <p style="color:#f1f5f9;font-size:13px;">{{ lead.created_at.strftime('%B %d, %Y at %H:%M') if lead.created_at else '-' }}</p>
        </div>
    </div>
</div>

{% endblock %}
{% block scripts %}
function updateStatus(status) {
    fetch('/leads/{{ lead.id }}/status', {
        method: 'PATCH',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({status: status})
    }).then(() => location.reload());
}
{% endblock %}